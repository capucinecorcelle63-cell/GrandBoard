{% extends 'base.html' %}
{% block title %}Grandboard - Entrées{% endblock %}
{% block content %}
<div class="row">
  <aside class="col-12 col-lg-3 mb-4">
    <div class="p-3 rounded shadow-sm bg-white">
  <h2 class="h5 mb-3 fw-bold" style="color: #111; font-weight: bold;">Filtres</h2>
      <form method="get" class="vstack gap-3">
        <select class="form-select" name="category" style="color: #111;">
    <option value="" style="color: #111;">Toutes les catégories</option>
          {% for category in categories %}
            <option value="{{ category.id }}" {% if selected_category == category.id %}selected{% endif %} style="color: #111; background-color: {{ category_colors[category.id] }};">{{ category.name }}</option>
          {% endfor %}
        </select>
        <select class="form-select" name="type" style="color: #111;">
          <option value="" style="color: #111;">Tous les thèmes 1</option>
          {% for type_val in all_types %}
            <option value="{{ type_val }}" {% if selected_type == type_val %}selected{% endif %} style="color: #111;">{{ type_val }}</option>
          {% endfor %}
        </select>
        <select class="form-select" name="theme" style="color: #111;">
          <option value="" style="color: #111;">Tous les thèmes 2</option>
          {% for th in all_themes %}
            <option value="{{ th }}" {% if selected_theme == th %}selected{% endif %} style="color: #111;">{{ th }}</option>
          {% endfor %}
        </select>
        <div class="mb-2">
          <label class="form-label fw-bold" style="color: #111; font-weight: bold;">Mois :</label>
          <div class="d-flex flex-wrap gap-1">
            <button type="submit" name="month" value="all" class="btn btn-outline-dark btn-sm {% if request.args.get('month') == 'all' or not request.args.get('month') %}active{% endif %}">Voir tout</button>
            {% for m, label in months %}
              <button type="submit" name="month" value="{{ m }}" class="btn btn-outline-dark btn-sm {% if request.args.get('month') == m %}active{% endif %}">{{ label }}</button>
            {% endfor %}
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label fw-bold" style="color: #111; font-weight: bold;">Année :</label>
          <select class="form-select" name="year" style="color: #111; width: 100%;">
            <option value="all" {% if request.args.get('year') == 'all' or not request.args.get('year') %}selected{% endif %}>Toutes les années</option>
            {% for y in years %}
              <option value="{{ y }}" {% if request.args.get('year') == y|string %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
          </select>
        </div>
  <button type="submit" class="btn btn-dark">Filtrer</button>
      </form>
      <div class="mt-3 d-grid gap-2 mb-2">
        <a href="{{ url_for('main.change_password') }}" class="btn btn-dark" style="color: #fff;">Mot de passe</a>
      </div>
      <hr class="my-4">
    </div>
  </aside>
  <section class="col-12 col-lg-9">
    {% if entries %}
      <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
        {% for entry in entries %}
          <div class="col">
              <a href="{{ url_for('main.edit_entry', entry_id=entry[0].id) }}" style="text-decoration: none;">
                <article class="grandboard-card h-100 entry-card" style="--category-color: {{ entry[1] }}; background-color: {{ entry[1] }}">
                {% if entry[0].image_filename %}
                  <img src="{{ url_for('static', filename=entry[0].image_filename) }}" class="card-img-top entry-image" alt="{{ entry[0].title }}">
                {% elif entry[0].image_url %}
                  <img src="{{ entry[0].image_url }}" class="card-img-top entry-image" alt="{{ entry[0].title }}">
                {% endif %}
                <div class="card-body" style="color: #111;">
                  <h3 class="card-title fw-bold" style="color: #111;">{{ entry[0].title }}</h3>
                  <div class="d-flex gap-2 mb-2">
                    <span class="badge rounded-pill category-badge" style="color: #111; background: rgba(255,255,255,0.5); --category-color: {{ entry[1] }};">{{ entry[0].category.name }}</span>
                    <span class="badge rounded-pill theme-badge" style="color: #111; background: rgba(255,255,255,0.5); --category-color: {{ entry[1] }};">{{ entry[0].theme_principal }}</span>
                    {% if entry[0].theme_associe %}
                      <span class="badge rounded-pill theme-badge" style="color: #111; background: rgba(255,255,255,0.5); --category-color: {{ entry[1] }};">{{ entry[0].theme_associe }}</span>
                    {% endif %}
                  </div>
                  <p class="card-text small" style="color: #111;">{{ entry[0].description }}</p>
                </div>
                <div class="card-footer bg-transparent border-0 text-end">
                    {% if entry[0].link %}
                      <a class="btn btn-outline-light" href="{{ entry[0].link }}" target="_blank" style="color: black; border-color: black;">Voir le lien</a>
                    {% endif %}
                </div>
              </article>
            </a>
          </div>
        {% endfor %}
      </div>
    {% else %}
  <div class="alert alert-info">Aucune entrée pour ce mois.</div>
    {% endif %}
  </section>
</div>
{% endblock %}
